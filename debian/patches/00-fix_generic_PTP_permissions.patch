From: David Paleino <dapal@debian.org>
Subject: fix unset permissions with the generic PTP rule
Origin: vendor
Bug-Debian: http://bugs.debian.org/620941
 http://bugs.debian.org/616648
Forwarded: no

---
 packaging/generic/print-camera-list.c |   22 ++++++++++++++++++++--
 1 file changed, 20 insertions(+), 2 deletions(-)

--- libgphoto2.orig/packaging/generic/print-camera-list.c
+++ libgphoto2/packaging/generic/print-camera-list.c
@@ -413,8 +413,8 @@ udev_parse_params (const func_params_t *
 		/* ignore mass storage class having devices in mark-up */
 		"ENV{ID_USB_INTERFACES}==\"*:08*:*\", GOTO=\"libgphoto2_usb_end\"\n"
 		/* shortcut the most common camera driver, ptp class, so we avoid parsing 1000
-		 * more rules */
-		"ENV{ID_USB_INTERFACES}==\"*:060101:*\", ENV{ID_GPHOTO2}=\"1\", ENV{GPHOTO2_DRIVER}=\"PTP\", GOTO=\"libgphoto2_usb_end\"\n\n"
+		 * more rules . It will be completed in udev_begin_func() */
+		"ENV{ID_USB_INTERFACES}==\"*:060101:*\", ENV{ID_GPHOTO2}=\"1\", ENV{GPHOTO2_DRIVER}=\"PTP\", "
 	};
 	static const char * const usbcam_strings[] = {
 		/* UDEV_PRE_0_98 */
@@ -507,6 +507,22 @@ udev_begin_func (const func_params_t *pa
 		print_version_comment(stdout, "# ", "\n", NULL, "#\n");
 		printf ("# this file is autogenerated, local changes will be LOST on upgrades\n");
 		printf (pdata->begin_string);
+
+		if (pdata->version == UDEV_136) {
+			if (pdata->mode != NULL || pdata->owner != NULL || pdata->group != NULL) {
+				if (pdata->mode != NULL) {
+					printf("MODE=\"%s\", ", pdata->mode);
+				}
+				if (pdata->owner != NULL) {
+					printf("OWNER=\"%s\", ", pdata->owner);
+				}
+				if (pdata->group != NULL) {
+					printf("GROUP=\"%s\", ", pdata->group);
+				}
+			}
+
+			printf ("GOTO=\"libgphoto2_usb_end\"\n\n");
+		}
 	}
 	return 0;
 }
